 /*
 * Microstepping demo
 *
 * This requires that M0, M1 be connected in addition to STEP,DIR
 *
 * Copyright (C)2015 Laurentiu Badea
 *
 * This file may be redistributed under the terms of the MIT license.
 * A copy of this license has been included with this distribution in the file LICENSE.
 */

//#110 rpm is okay/
#include <Arduino.h>
#include <Shoot_the_moon.h>
#include <TimerThree.h>

//float traj_ref[300]= {0.0469386,0.0467345,0.0465326,0.0463327,0.0461347,0.0459388,0.0457447,0.0455525,0.0453622,0.0451737,0.0449869,0.0448019,0.0446186,0.0444371,0.0442571,0.0440788,0.0439022,0.043727,0.0435535,0.0433815,0.043211,0.0430419,0.0428744,0.0427082,0.0425435,0.0423802,0.0422182,0.0420577,0.0418984,0.0417405,0.0415838,0.0414285,0.0412744,0.0411216,0.04097,0.0408196,0.0406704,0.0405224,0.0403756,0.0402299,0.0400853,0.0399419,0.0397996,0.0396584,0.0395182,0.0393792,0.0392412,0.0391042,0.0389683,0.0388334,0.0386995,0.0385666,0.0384347,0.0383037,0.0381738,0.0380447,0.0379167,0.0377895,0.0376633,0.037538,0.0374135,0.03729,0.0371674,0.0370456,0.0369247,0.0368046,0.0366854,0.036567,0.0364495,0.0363327,0.0362168,0.0361017,0.0359874,0.0358738,0.035761,0.035649,0.0355378,0.0354273,0.0353176,0.0352086,0.0351003,0.0349928,0.034886,0.0347799,0.0346745,0.0345698,0.0344658,0.0343624,0.0342598,0.0341578,0.0340565,0.0339559,0.0338559,0.0337565,0.0336578,0.0335597,0.0334623,0.0333655,0.0332693,0.0331737,0.0330787,0.0329843,0.0328905,0.0327973,0.0327047,0.0326127,0.0325212,0.0324304,0.03234,0.0322503,0.0321611,0.0320724,0.0319843,0.0318968,0.0318098,0.0317233,0.0316373,0.0315519,0.031467,0.0313826,0.0312987,0.0312153,0.0311324,0.03105,0.0309681,0.0308867,0.0308058,0.0307254,0.0306455,0.030566,0.030487,0.0304084,0.0303304,0.0302527,0.0301756,0.0300989,0.0300226,0.0299468,0.0298715,0.0297965,0.029722,0.029648,0.0295743,0.0295011,0.0294284,0.029356,0.0292841,0.0292125,0.0291414,0.0290707,0.0290004,0.0289304,0.0288609,0.0287918,0.0287231,0.0286547,0.0285868,0.0285192,0.028452,0.0283852,0.0283188,0.0282527,0.0281871,0.0281217,0.0280568,0.0279922,0.0279279,0.0278641,0.0278006,0.0277374,0.0276746,0.0276121,0.02755,0.0274882,0.0274268,0.0273657,0.0273049,0.0272445,0.0271844,0.0271246,0.0270652,0.027006,0.0269472,0.0268888,0.0268306,0.0267728,0.0267153,0.0266581,0.0266012,0.0265446,0.0264883,0.0264323,0.0263767,0.0263213,0.0262662,0.0262115,0.026157,0.0261028,0.0260489,0.0259953,0.025942,0.025889,0.0258363,0.0257838,0.0257316,0.0256798,0.0256282,0.0255768,0.0255258,0.025475,0.0254245,0.0253742,0.0253243,0.0252746,0.0252251,0.025176,0.0251271,0.0250784,0.02503,0.0249819,0.024934,0.0248864,0.0248391,0.024792,0.0247451,0.0246985,0.0246522,0.0246061,0.0245602,0.0245146,0.0244693,0.0244241,0.0243793,0.0243346,0.0242902,0.0242461,0.0242021,0.0241585,0.024115,0.0240718,0.0240288,0.023986,0.0239435,0.0239012,0.0238592,0.0238173,0.0237757,0.0237343,0.0236931,0.0236522,0.0236115,0.023571,0.0235307,0.0234906,0.0234508,0.0234111,0.0233717,0.0233325,0.0232935,0.0232547,0.0232162,0.0231778,0.0231397,0.0231018,0.023064,0.0230265,0.0229892,0.0229521,0.0229152,0.0228785,0.022842,0.0228057,0.0227696,0.0227337,0.022698,0.0226625,0.0226272,0.0225921,0.0225572,0.0225225,0.022488,0.0224537,0.0224195,0.0223856,0.0223519,0.0223183,0.022285,0.0222518,0.0222188,0.022186,0.0221534,0.022121,0.0220888,0.0220567,0.0220248,0.0219932,0.0219617,0.0219304,0.0218992,0.0218683,};
//float traj_ref[600]={0.0282452,0.0282043,0.0281616,0.028117,0.0280707,0.0280226,0.0279729,0.0279216,0.0278687,0.0278143,0.0277585,0.0277012,0.0276426,0.0275828,0.0275216,0.0274593,0.0273957,0.0273311,0.0272654,0.0271986,0.0271309,0.0270622,0.0269926,0.0269221,0.0268507,0.0267785,0.0267056,0.0266319,0.0265576,0.0264825,0.0264069,0.0263306,0.0262537,0.0261763,0.0260984,0.02602,0.0259412,0.0258619,0.0257822,0.0257021,0.0256217,0.025541,0.02546,0.0253787,0.0252972,0.0252154,0.0251334,0.0250513,0.024969,0.0248866,0.0248041,0.0247214,0.0246387,0.024556,0.0244732,0.0243905,0.0243077,0.024225,0.0241423,0.0240597,0.0239772,0.0238948,0.0238125,0.0237303,0.0236483,0.0235665,0.0234848,0.0234034,0.0233222,0.0232412,0.0231605,0.02308,0.0229998,0.0229199,0.0228403,0.022761,0.0226821,0.0226035,0.0225253,0.0224475,0.02237,0.0222929,0.0222163,0.0221401,0.0220643,0.021989,0.0219141,0.0218397,0.0217658,0.0216923,0.0216194,0.021547,0.0214751,0.0214038,0.021333,0.0212627,0.0211931,0.021124,0.0210555,0.0209875,0.0209202,0.0208535,0.0207874,0.020722,0.0206572,0.020593,0.0205295,0.0204666,0.0204045,0.020343,0.0202822,0.020222,0.0201626,0.0201039,0.020046,0.0199887,0.0199322,0.0198764,0.0198214,0.0197671,0.0197135,0.0196608,0.0196088,0.0195576,0.0195071,0.0194575,0.0194087,0.0193606,0.0193134,0.019267,0.0192214,0.0191766,0.0191326,0.0190895,0.0190472,0.0190058,0.0189652,0.0189255,0.0188866,0.0188486,0.0188115,0.0187752,0.0187398,0.0187053,0.0186717,0.018639,0.0186072,0.0185762,0.0185462,0.018517,0.0184888,0.0184615,0.0184351,0.0184096,0.0183851,0.0183615,0.0183388,0.018317,0.0182962,0.0182763,0.0182573,0.0182393,0.0182223,0.0182062,0.018191,0.0181768,0.0181636,0.0181513,0.01814,0.0181297,0.0181203,0.0181119,0.0181044,0.018098,0.0180925,0.018088,0.0180845,0.0180819,0.0180804,0.0180798,0.0180802,0.0180816,0.018084,0.0180874,0.0180918,0.0180972,0.0181035,0.0181109,0.0181193,0.0181287,0.018139,0.0181504,0.0181628,0.0181762,0.0181906,0.018206,0.0182225,0.0182399,0.0182583,0.0182778,0.0182983,0.0183198,0.0183423,0.0183658,0.0183903,0.0184159,0.0184425,0.0184701,0.0184987,0.0185283,0.018559,0.0185906,0.0186233,0.0186571,0.0186918,0.0187276,0.0187644,0.0188022,0.018841,0.0188809,0.0189218,0.0189637,0.0190067,0.0190507,0.0190957,0.0191417,0.0191887,0.0192368,0.0192859,0.0193361,0.0193872,0.0194394,0.0194926,0.0195469,0.0196021,0.0196584,0.0197158,0.0197741,0.0198335,0.0198939,0.0199553,0.0200178,0.0200813,0.0201458,0.0202113,0.0202778,0.0203454,0.020414,0.0204836,0.0205543,0.0206259,0.0206986,0.0207723,0.020847,0.0209227,0.0209995,0.0210773,0.021156,0.0212358,0.0213166,0.0213984,0.0214813,0.0215651,0.0216499,0.0217358,0.0218226,0.0219104,0.0219993,0.0220891,0.02218,0.0222718,0.0223646,0.0224584,0.0225532,0.022649,0.0227457,0.0228435,0.0229422,0.0230418,0.0231425,0.0232441,0.0233467,0.0234502,0.0235547,0.0236602,0.0237666,0.0238739,0.0239822,0.0240915,0.0242016,0.0243127,0.0244247,0.0245376,0.0246515,0.0247662,0.0248819,0.0249984,0.0251159,0.0252342,0.0253534,0.0254735,0.0255944,0.0257162,0.0258389,0.0259624,0.0260868,0.026212,0.026338,0.0264648,0.0265924,0.0267209,0.0268501,0.0269801,0.0271109,0.0272425,0.0273748,0.0275079,0.0276417,0.0277763,0.0279115,0.0280475,0.0281842,0.0283215,0.0284596,0.0285983,0.0287376,0.0288776,0.0290182,0.0291595,0.0293013,0.0294438,0.0295868,0.0297304,0.0298745,0.0300192,0.0301644,0.0303102,0.0304564,0.0306031,0.0307503,0.0308979,0.0310459,0.0311944,0.0313433,0.0314926,0.0316422,0.0317923,0.0319426,0.0320933,0.0322443,0.0323955,0.032547,0.0326988,0.0328509,0.0330031,0.0331555,0.0333081,0.0334609,0.0336138,0.0337668,0.0339199,0.0340731,0.0342263,0.0343796,0.0345329,0.0346862,0.0348395,0.0349927,0.0351458,0.0352989,0.0354518,0.0356046,0.0357572,0.0359096,0.0360618,0.0362138,0.0363655,0.036517,0.0366681,0.0368189,0.0369693,0.0371194,0.0372691,0.0374183,0.037567,0.0377153,0.0378631,0.0380103,0.038157,0.038303,0.0384485,0.0385933,0.0387374,0.0388808,0.0390235,0.0391655,0.0393066,0.039447,0.0395865,0.0397251,0.0398628,0.0399996,0.0401354,0.0402703,0.0404041,0.0405369,0.0406686,0.0407992,0.0409287,0.041057,0.0411841,0.04131,0.0414346,0.041558,0.04168,0.0418007,0.04192,0.042038,0.0421544,0.0422695,0.042383,0.042495,0.0426055,0.0427144,0.0428216,0.0429273,0.0430313,0.0431335,0.0432341,0.0433329,0.0434299,0.0435252,0.0436186,0.0437101,0.0437998,0.0438875,0.0439733,0.0440572,0.044139,0.0442189,0.0442967,0.0443724,0.0444461,0.0445177,0.0445872,0.0446545,0.0447196,0.0447825,0.0448433,0.0449018,0.0449581,0.0450121,0.0450639,0.0451133,0.0451605,0.0452053,0.0452478,0.0452879,0.0453257,0.0453611,0.0453941,0.0454247,0.045453,0.0454788,0.0455022,0.0455232,0.0455417,0.0455578,0.0455715,0.0455827,0.0455915,0.0455979,0.0456018,0.0456032,0.0456023,0.0455988,0.045593,0.0455847,0.045574,0.0455609,0.0455454,0.0455274,0.0455071,0.0454844,0.0454593,0.0454318,0.045402,0.0453698,0.0453354,0.0452986,0.0452595,0.0452181,0.0451745,0.0451286,0.0450805,0.0450302,0.0449777,0.0449231,0.0448663,0.0448073,0.0447463,0.0446832,0.044618,0.0445508,0.0444816,0.0444104,0.0443372,0.0442621,0.0441851,0.0441062,0.0440254,0.0439429,0.0438585,0.0437723,0.0436844,0.0435948,0.0435035,0.0434106,0.043316,0.0432198,0.043122,0.0430228,0.0429219,0.0428197,0.0427159,0.0426108,0.0425042,0.0423963,0.042287,0.0421765,0.0420647,0.0419516,0.0418373,0.0417219,0.0416053,0.0414875,0.0413687,0.0412488,0.0411279,0.041006,0.040883,0.0407592,0.0406344,0.0405087,0.0403822,0.0402548,0.0401266,0.0399977,0.039868,0.0397375,0.0396064,0.0394746,0.0393421,0.039209,0.0390753,0.038941,0.0388062,0.0386709,0.038535,0.0383987,0.038262,0.0381248,0.0379871,0.0378492,0.0377108,0.0375721,0.0374331,0.0372938,0.0371542,0.0370144,0.0368743,0.036734,0.0365935,0.0364528,0.036312,0.036171,0.0360299,0.0358887,0.0357474,0.0356061,0.0354647,0.0353232,0.0351818,0.0350403,0.0348989,0.0347575,0.0346161,0.0344748,0.0343335,0.0341923,0.0340513,0.0339103,0.0337695,0.0336289,0.0334883,0.033348,0.0332078,0.0330678,0.0329281,0.0327885};

//Mars trejactory
// float traj_ref[500] = {0.09555,0.094453,0.0933697,0.0922994,0.0912417,0.0901962,0.0891624,0.0881398,0.0871283,0.0861275,0.085137,0.0841566,0.0831862,0.0822254,0.0812741,0.0803321,0.0793994,0.0784757,0.077561,0.0766551,0.075758,0.0748697,0.07399,0.073119,0.0722566,0.0714027,0.0705575,0.0697207,0.0688926,0.068073,0.067262,0.0664595,0.0656657,0.0648805,0.064104,0.0633361,0.062577,0.0618265,0.0610849,0.060352,0.0596279,0.0589126,0.0582062,0.0575086,0.05682,0.0561403,0.0554695,0.0548076,0.0541547,0.0535107,0.0528757,0.0522497,0.0516326,0.0510245,0.0504253,0.0498351,0.0492538,0.0486814,0.0481178,0.0475631,0.0470173,0.0464802,0.045952,0.0454324,0.0449215,0.0444192,0.0439256,0.0434405,0.0429638,0.0424957,0.0420358,0.0415843,0.0411411,0.0407061,0.0402791,0.0398603,0.0394494,0.0390464,0.0386513,0.0382639,0.0378842,0.0375121,0.0371475,0.0367904,0.0364406,0.0360981,0.0357628,0.0354346,0.0351134,0.0347991,0.0344916,0.0341909,0.0338969,0.0336094,0.0333284,0.0330538,0.0327854,0.0325233,0.0322672,0.0320172,0.0317731,0.0315348,0.0313022,0.0310753,0.0308539,0.030638,0.0304275,0.0302222,0.0300221,0.029827,0.029637,0.0294519,0.0292716,0.029096,0.0289251,0.0287587,0.0285967,0.0284392,0.0282859,0.0281369,0.0279919,0.027851,0.027714,0.0275809,0.0274516,0.027326,0.027204,0.0270856,0.0269706,0.026859,0.0267508,0.0266457,0.0265439,0.0264451,0.0263493,0.0262565,0.0261666,0.0260794,0.025995,0.0259133,0.0258342,0.0257576,0.0256834,0.0256117,0.0255424,0.0254753,0.0254104,0.0253477,0.0252871,0.0252286,0.0251721,0.0251175,0.0250647,0.0250139,0.0249648,0.0249174,0.0248717,0.0248276,0.0247852,0.0247442,0.0247048,0.0246668,0.0246302,0.0245949,0.024561,0.0245284,0.024497,0.0244668,0.0244377,0.0244098,0.024383,0.0243572,0.0243324,0.0243087,0.0242858,0.0242639,0.0242429,0.0242228,0.0242034,0.0241849,0.0241671,0.0241501,0.0241338,0.0241182,0.0241033,0.024089,0.0240754,0.0240623,0.0240498,0.0240379,0.0240265,0.0240156,0.0240052,0.0239953,0.0239859,0.0239769,0.0239683,0.0239601,0.0239523,0.0239449,0.0239378,0.0239311,0.0239248,0.0239187,0.023913,0.0239075,0.0239023,0.0238974,0.0238928,0.0238883,0.0238842,0.0238802,0.0238765,0.023873,0.0238697,0.0238665,0.0238636,0.0238608,0.0238581,0.0238557,0.0238534,0.0238512,0.0238492,0.0238472,0.0238455,0.0238438,0.0238422,0.0238408,0.0238394,0.0238382,0.023837,0.0238359,0.023835,0.023834,0.0238332,0.0238324,0.0238317,0.0238311,0.0238305,0.02383,0.0238295,0.0238291,0.0238287,0.0238284,0.0238281,0.0238278,0.0238276,0.0238274,0.0238273,0.0238272,0.0238271,0.0238271,0.023827,0.023827,0.023827,0.0238271,0.0238271,0.0238272,0.0238273,0.0238274,0.0238275,0.0238277,0.0238278,0.023828,0.0238281,0.0238283,0.0238285,0.0238287,0.0238289,0.0238291,0.0238293,0.0238296,0.0238298,0.02383,0.0238302,0.0238305,0.0238307,0.023831,0.0238312,0.0238315,0.0238317,0.0238319,0.0238322,0.0238324,0.0238327,0.0238329,0.0238332,0.0238334,0.0238337,0.0238339,0.0238342,0.0238344,0.0238346,0.0238349,0.0238351,0.0238353,0.0238356,0.0238358,0.023836,0.0238363,0.0238365,0.0238367,0.0238369,0.0238371,0.0238373,0.0238376,0.0238378,0.023838,0.0238382,0.0238384,0.0238386,0.0238388,0.023839,0.0238392,0.0238393,0.0238395,0.0238397,0.0238399,0.0238401,0.0238402,0.0238404,0.0238406,0.0238408,0.0238409,0.0238411,0.0238412,0.0238414,0.0238416,0.0238417,0.0238419,0.023842,0.0238422,0.0238423,0.0238424,0.0238426,0.0238427,0.0238429,0.023843,0.0238431,0.0238433,0.0238434,0.0238435,0.0238436,0.0238438,0.0238439,0.023844,0.0238441,0.0238442,0.0238444,0.0238445,0.0238446,0.0238447,0.0238448,0.0238449,0.023845,0.0238451,0.0238452,0.0238453,0.0238454,0.0238455,0.0238456,0.0238457,0.0238458,0.0238459,0.023846,0.0238461,0.0238462,0.0238463,0.0238464,0.0238465,0.0238465,0.0238466,0.0238467,0.0238468,0.0238469,0.023847,0.023847,0.0238471,0.0238472,0.0238473,0.0238474,0.0238474,0.0238475,0.0238476,0.0238477,0.0238477,0.0238478,0.0238479,0.0238479,0.023848,0.0238481,0.0238482,0.0238482,0.0238483,0.0238484,0.0238484,0.0238485,0.0238485,0.0238486,0.0238487,0.0238487,0.0238488,0.0238489,0.0238489,0.023849,0.023849,0.0238491,0.0238492,0.0238492,0.0238493,0.0238493,0.0238494,0.0238495,0.0238495,0.0238496,0.0238496,0.0238497,0.0238497,0.0238498,0.0238498,0.0238499,0.0238499,0.02385,0.02385,0.0238501,0.0238501,0.0238502,0.0238502,0.0238503,0.0238503,0.0238504,0.0238504,0.0238505,0.0238505,0.0238506,0.0238506,0.0238507,0.0238507,0.0238508,0.0238508,0.0238509,0.0238509,0.0238509,0.023851,0.023851,0.0238511,0.0238511,0.0238512,0.0238512,0.0238512,0.0238513,0.0238513,0.0238514,0.0238514,0.0238514,0.0238515,0.0238515,0.0238516,0.0238516,0.0238516,0.0238517,0.0238517,0.0238518,0.0238518,0.0238518,0.0238519,0.0238519,0.0238519,0.023852,0.023852,0.023852,0.0238521,0.0238521,0.0238521,0.0238522,0.0238522,0.0238523,0.0238523,0.0238523,0.0238524,0.0238524,0.0238524,0.0238524,0.0238525,0.0238525,0.0238525,0.0238526,0.0238526,0.0238526,0.0238527,0.0238527,0.0238527,0.0238528,0.0238528,0.0238528,0.0238528,0.0238529,0.0238529,0.0238529,0.023853};

//Jupiter trejactory
//float traj_ref[500] = {0.11945,0.117824,0.116218,0.11463,0.113059,0.111504,0.109966,0.108442,0.106933,0.105437,0.103955,0.102487,0.101031,0.0995874,0.0981564,0.0967376,0.095331,0.0939365,0.092554,0.0911835,0.0898252,0.0884791,0.0871453,0.0858239,0.0845151,0.0832189,0.0819356,0.0806653,0.0794082,0.0781646,0.0769345,0.0757182,0.0745158,0.0733276,0.0721537,0.0709943,0.0698496,0.0687197,0.0676047,0.0665049,0.0654202,0.0643509,0.0632971,0.0622588,0.0612361,0.060229,0.0592377,0.0582621,0.0573023,0.0563582,0.05543,0.0545175,0.0536208,0.0527397,0.0518744,0.0510246,0.0501903,0.0493715,0.048568,0.0477798,0.0470068,0.0462488,0.0455058,0.0447775,0.044064,0.0433649,0.0426803,0.04201,0.0413537,0.0407114,0.0400829,0.0394681,0.0388667,0.0382787,0.0377038,0.0371419,0.0365929,0.0360564,0.0355325,0.0350209,0.0345214,0.0340339,0.0335582,0.0330941,0.0326415,0.0322001,0.0317699,0.0313506,0.030942,0.030544,0.0301565,0.0297791,0.0294119,0.0290546,0.0287069,0.0283689,0.0280402,0.0277208,0.0274104,0.0271089,0.0268162,0.026532,0.0262562,0.0259886,0.0257291,0.0254775,0.0252337,0.0249974,0.0247686,0.0245471,0.0243327,0.0241253,0.0239246,0.0237307,0.0235433,0.0233622,0.0231873,0.0230186,0.0228557,0.0226987,0.0225473,0.0224014,0.0222609,0.0221256,0.0219955,0.0218703,0.0217499,0.0216342,0.0215232,0.0214165,0.0213143,0.0212162,0.0211222,0.0210322,0.0209461,0.0208637,0.0207849,0.0207097,0.0206378,0.0205693,0.020504,0.0204418,0.0203825,0.0203262,0.0202727,0.0202219,0.0201737,0.0201281,0.0200849,0.020044,0.0200054,0.019969,0.0199347,0.0199024,0.0198721,0.0198437,0.019817,0.0197921,0.0197689,0.0197472,0.0197271,0.0197084,0.0196912,0.0196753,0.0196607,0.0196473,0.0196351,0.019624,0.019614,0.019605,0.0195969,0.0195898,0.0195836,0.0195782,0.0195736,0.0195698,0.0195667,0.0195642,0.0195624,0.0195612,0.0195606,0.0195605,0.0195609,0.0195618,0.0195632,0.0195649,0.0195671,0.0195696,0.0195725,0.0195757,0.0195792,0.0195829,0.019587,0.0195912,0.0195957,0.0196004,0.0196053,0.0196103,0.0196155,0.0196208,0.0196263,0.0196319,0.0196375,0.0196433,0.0196491,0.019655,0.019661,0.019667,0.019673,0.0196791,0.0196851,0.0196912,0.0196974,0.0197035,0.0197096,0.0197157,0.0197217,0.0197278,0.0197338,0.0197398,0.0197458,0.0197517,0.0197576,0.0197635,0.0197693,0.019775,0.0197807,0.0197864,0.0197919,0.0197975,0.0198029,0.0198084,0.0198137,0.019819,0.0198242,0.0198294,0.0198345,0.0198395,0.0198445,0.0198494,0.0198542,0.019859,0.0198637,0.0198683,0.0198729,0.0198774,0.0198819,0.0198862,0.0198905,0.0198948,0.019899,0.0199031,0.0199072,0.0199112,0.0199151,0.019919,0.0199228,0.0199265,0.0199302,0.0199339,0.0199375,0.019941,0.0199445,0.0199479,0.0199513,0.0199546,0.0199578,0.0199611,0.0199642,0.0199673,0.0199704,0.0199734,0.0199764,0.0199793,0.0199822,0.019985,0.0199878,0.0199905,0.0199932,0.0199959,0.0199985,0.0200011,0.0200036,0.0200061,0.0200086,0.020011,0.0200134,0.0200158,0.0200181,0.0200204,0.0200226,0.0200249,0.020027,0.0200292,0.0200313,0.0200334,0.0200355,0.0200375,0.0200395,0.0200415,0.0200435,0.0200454,0.0200473,0.0200491,0.020051,0.0200528,0.0200546,0.0200564,0.0200581,0.0200598,0.0200615,0.0200632,0.0200649,0.0200665,0.0200681,0.0200697,0.0200713,0.0200728,0.0200743,0.0200758,0.0200773,0.0200788,0.0200803,0.0200817,0.0200831,0.0200845,0.0200859,0.0200873,0.0200886,0.02009,0.0200913,0.0200926,0.0200939,0.0200951,0.0200964,0.0200976,0.0200989,0.0201001,0.0201013,0.0201025,0.0201036,0.0201048,0.0201059,0.0201071,0.0201082,0.0201093,0.0201104,0.0201115,0.0201125,0.0201136,0.0201146,0.0201157,0.0201167,0.0201177,0.0201187,0.0201197,0.0201207,0.0201217,0.0201226,0.0201236,0.0201245,0.0201254,0.0201264,0.0201273,0.0201282,0.0201291,0.02013,0.0201308,0.0201317,0.0201326,0.0201334,0.0201342,0.0201351,0.0201359,0.0201367,0.0201375,0.0201383,0.0201391,0.0201399,0.0201407,0.0201414,0.0201422,0.0201429,0.0201437,0.0201444,0.0201451,0.0201459,0.0201466,0.0201473,0.020148,0.0201487,0.0201494,0.02015,0.0201507,0.0201514,0.0201521,0.0201527,0.0201534,0.020154,0.0201546,0.0201553,0.0201559,0.0201565,0.0201571,0.0201577,0.0201583,0.0201589,0.0201595,0.0201601,0.0201607,0.0201612,0.0201618,0.0201624,0.0201629,0.0201635,0.020164,0.0201646,0.0201651,0.0201656,0.0201662,0.0201667,0.0201672,0.0201677,0.0201682,0.0201687,0.0201692,0.0201697,0.0201702,0.0201707,0.0201712,0.0201716,0.0201721,0.0201726,0.020173,0.0201735,0.0201739,0.0201744,0.0201748,0.0201753,0.0201757,0.0201761,0.0201766,0.020177,0.0201774,0.0201778,0.0201783,0.0201787,0.0201791,0.0201795,0.0201799,0.0201803,0.0201807,0.020181,0.0201814,0.0201818,0.0201822,0.0201825,0.0201829,0.0201833,0.0201836,0.020184,0.0201844,0.0201847,0.0201851,0.0201854,0.0201858,0.0201861,0.0201864,0.0201868,0.0201871,0.0201874,0.0201877,0.0201881,0.0201884,0.0201887,0.020189,0.0201893,0.0201896,0.0201899,0.0201902,0.0201905,0.0201908,0.0201911,0.0201914,0.0201917,0.020192,0.0201923,0.0201926,0.0201928,0.0201931,0.0201934,0.0201936,0.0201939,0.0201942,0.0201944,0.0201947,0.020195,0.0201952,0.0201955,0.0201957};

//Saturn trejactory
// float traj_ref[500]={0.14335,0.141205,0.139084,0.136986,0.134908,0.132849,0.130809,0.128785,0.126778,0.124787,0.122811,0.120849,0.118902,0.116968,0.115049,0.113144,0.111254,0.109377,0.107516,0.105669,0.103838,0.102023,0.100224,0.0984414,0.0966765,0.0949295,0.0932009,0.0914913,0.0898012,0.0881312,0.0864817,0.0848534,0.0832466,0.0816618,0.0800994,0.0785598,0.0770434,0.0755504,0.0740812,0.0726358,0.0712146,0.0698177,0.068445,0.0670968,0.065773,0.0644736,0.0631985,0.0619477,0.0607209,0.0595181,0.0583391,0.0571837,0.0560516,0.0549426,0.0538564,0.0527927,0.0517513,0.0507318,0.0497339,0.0487573,0.0478017,0.0468668,0.0459521,0.0450575,0.0441825,0.0433269,0.0424903,0.0416724,0.0408729,0.0400915,0.0393279,0.0385818,0.0378529,0.0371409,0.0364456,0.0357667,0.0351039,0.034457,0.0338258,0.0332099,0.0326092,0.0320234,0.0314524,0.0308957,0.0303534,0.0298251,0.0293106,0.0288097,0.0283223,0.027848,0.0273867,0.0269383,0.0265024,0.026079,0.0256677,0.0252685,0.024881,0.0245052,0.0241408,0.0237876,0.0234455,0.0231141,0.0227934,0.0224831,0.0221831,0.0218931,0.021613,0.0213425,0.0210815,0.0208298,0.0205871,0.0203533,0.0201282,0.0199116,0.0197033,0.0195031,0.0193109,0.0191264,0.0189494,0.0187797,0.0186173,0.0184618,0.0183132,0.0181712,0.0180356,0.0179063,0.0177831,0.0176658,0.0175542,0.0174483,0.0173477,0.0172524,0.0171622,0.0170769,0.0169964,0.0169205,0.016849,0.0167818,0.0167188,0.0166598,0.0166047,0.0165533,0.0165054,0.016461,0.01642,0.0163821,0.0163473,0.0163155,0.0162864,0.0162601,0.0162363,0.016215,0.0161961,0.0161794,0.0161649,0.0161524,0.0161418,0.0161332,0.0161262,0.016121,0.0161173,0.0161152,0.0161144,0.016115,0.0161169,0.0161199,0.0161241,0.0161293,0.0161354,0.0161425,0.0161505,0.0161592,0.0161687,0.0161789,0.0161897,0.0162011,0.016213,0.0162254,0.0162382,0.0162514,0.0162651,0.016279,0.0162932,0.0163077,0.0163224,0.0163372,0.0163523,0.0163675,0.0163827,0.0163981,0.0164135,0.016429,0.0164445,0.0164599,0.0164754,0.0164908,0.0165062,0.0165215,0.0165367,0.0165518,0.0165669,0.0165818,0.0165966,0.0166112,0.0166257,0.0166401,0.0166543,0.0166683,0.0166822,0.0166959,0.0167094,0.0167228,0.016736,0.0167489,0.0167617,0.0167743,0.0167868,0.016799,0.016811,0.0168229,0.0168345,0.016846,0.0168572,0.0168683,0.0168792,0.0168899,0.0169004,0.0169108,0.0169209,0.0169309,0.0169407,0.0169503,0.0169597,0.016969,0.0169781,0.016987,0.0169958,0.0170044,0.0170128,0.0170211,0.0170292,0.0170372,0.017045,0.0170527,0.0170602,0.0170676,0.0170748,0.017082,0.017089,0.0170958,0.0171025,0.0171091,0.0171156,0.017122,0.0171282,0.0171343,0.0171404,0.0171463,0.0171521,0.0171578,0.0171634,0.0171688,0.0171742,0.0171795,0.0171847,0.0171898,0.0171949,0.0171998,0.0172046,0.0172094,0.0172141,0.0172187,0.0172232,0.0172277,0.017232,0.0172363,0.0172406,0.0172447,0.0172488,0.0172528,0.0172568,0.0172607,0.0172645,0.0172683,0.017272,0.0172757,0.0172793,0.0172828,0.0172863,0.0172897,0.0172931,0.0172964,0.0172997,0.017303,0.0173062,0.0173093,0.0173124,0.0173154,0.0173184,0.0173214,0.0173243,0.0173272,0.0173301,0.0173329,0.0173356,0.0173384,0.017341,0.0173437,0.0173463,0.0173489,0.0173515,0.017354,0.0173565,0.0173589,0.0173613,0.0173637,0.0173661,0.0173684,0.0173707,0.017373,0.0173752,0.0173775,0.0173796,0.0173818,0.0173839,0.0173861,0.0173881,0.0173902,0.0173922,0.0173943,0.0173963,0.0173982,0.0174002,0.0174021,0.017404,0.0174059,0.0174077,0.0174096,0.0174114,0.0174132,0.017415,0.0174167,0.0174185,0.0174202,0.0174219,0.0174236,0.0174252,0.0174269,0.0174285,0.0174301,0.0174317,0.0174333,0.0174348,0.0174364,0.0174379,0.0174394,0.0174409,0.0174424,0.0174439,0.0174453,0.0174468,0.0174482,0.0174496,0.017451,0.0174524,0.0174537,0.0174551,0.0174564,0.0174577,0.017459,0.0174603,0.0174616,0.0174629,0.0174642,0.0174654,0.0174666,0.0174679,0.0174691,0.0174703,0.0174715,0.0174726,0.0174738,0.017475,0.0174761,0.0174772,0.0174784,0.0174795,0.0174806,0.0174817,0.0174827,0.0174838,0.0174849,0.0174859,0.017487,0.017488,0.017489,0.01749,0.017491,0.017492,0.017493,0.017494,0.0174949,0.0174959,0.0174968,0.0174978,0.0174987,0.0174996,0.0175005,0.0175014,0.0175023,0.0175032,0.0175041,0.017505,0.0175058,0.0175067,0.0175075,0.0175084,0.0175092,0.01751,0.0175108,0.0175116,0.0175124,0.0175132,0.017514,0.0175148,0.0175156,0.0175163,0.0175171,0.0175178,0.0175186,0.0175193,0.0175201,0.0175208,0.0175215,0.0175222,0.0175229,0.0175236,0.0175243,0.017525,0.0175257,0.0175263,0.017527,0.0175277,0.0175283,0.017529,0.0175296,0.0175302,0.0175309,0.0175315,0.0175321,0.0175327,0.0175333,0.0175339,0.0175345,0.0175351,0.0175357,0.0175363,0.0175369,0.0175374,0.017538,0.0175386,0.0175391,0.0175397,0.0175402,0.0175408,0.0175413,0.0175418,0.0175423,0.0175429,0.0175434,0.0175439,0.0175444,0.0175449,0.0175454,0.0175459,0.0175464,0.0175469,0.0175473,0.0175478,0.0175483,0.0175487,0.0175492,0.0175497,0.0175501,0.0175506,0.017551,0.0175515,0.0175519,0.0175523,0.0175528,0.0175532,0.0175536,0.017554,0.0175544,0.0175548,0.0175553,0.0175557,0.0175561,0.0175565,0.0175568};

//Pluto trejactory
float traj_ref[500] = {0.16725,0.164597,0.161972,0.159371,0.156794,0.154237,0.151699,0.149178,0.146674,0.144186,0.141712,0.139254,0.13681,0.13438,0.131966,0.129566,0.127183,0.124817,0.122469,0.120139,0.117829,0.11554,0.113274,0.111031,0.108813,0.106621,0.104457,0.102321,0.100215,0.0981406,0.0960981,0.0940888,0.0921136,0.0901734,0.0882687,0.0864003,0.0845686,0.082774,0.0810168,0.0792971,0.0776149,0.0759702,0.0743628,0.0727923,0.0712585,0.0697609,0.0682989,0.0668719,0.0654793,0.0641203,0.0627942,0.0615001,0.0602373,0.0590048,0.0578017,0.0566272,0.0554804,0.0543602,0.053266,0.0521966,0.0511514,0.0501293,0.0491296,0.0481515,0.0471942,0.046257,0.045339,0.0444397,0.0435584,0.0426946,0.0418476,0.0410169,0.040202,0.0394026,0.0386182,0.0378485,0.0370931,0.0363518,0.0356243,0.0349104,0.0342099,0.0335227,0.0328487,0.0321877,0.0315397,0.0309046,0.0302823,0.029673,0.0290764,0.0284926,0.0279217,0.0273635,0.0268181,0.0262855,0.0257657,0.0252587,0.0247644,0.0242829,0.023814,0.0233578,0.0229142,0.0224832,0.0220646,0.0216584,0.0212645,0.0208827,0.0205131,0.0201554,0.0198095,0.0194753,0.0191527,0.0188414,0.0185413,0.0182522,0.017974,0.0177065,0.0174494,0.0172026,0.0169659,0.0167391,0.0165219,0.0163141,0.0161156,0.0159262,0.0157455,0.0155734,0.0154097,0.0152542,0.0151065,0.0149666,0.0148342,0.0147091,0.014591,0.0144798,0.0143753,0.0142771,0.0141852,0.0140993,0.0140192,0.0139447,0.0138756,0.0138117,0.0137529,0.0136989,0.0136495,0.0136046,0.013564,0.0135275,0.0134949,0.0134661,0.0134409,0.0134191,0.0134006,0.0133852,0.0133728,0.0133632,0.0133563,0.0133519,0.0133499,0.0133502,0.0133527,0.0133572,0.0133636,0.0133717,0.0133816,0.013393,0.0134059,0.0134201,0.0134356,0.0134522,0.01347,0.0134887,0.0135083,0.0135288,0.01355,0.0135719,0.0135944,0.0136174,0.0136409,0.0136648,0.0136891,0.0137137,0.0137385,0.0137636,0.0137888,0.0138141,0.0138395,0.0138649,0.0138904,0.0139158,0.0139411,0.0139663,0.0139914,0.0140164,0.0140412,0.0140658,0.0140902,0.0141144,0.0141383,0.0141619,0.0141853,0.0142084,0.0142312,0.0142537,0.0142759,0.0142977,0.0143193,0.0143405,0.0143613,0.0143818,0.014402,0.0144218,0.0144413,0.0144604,0.0144792,0.0144976,0.0145157,0.0145335,0.0145509,0.014568,0.0145847,0.0146011,0.0146172,0.0146329,0.0146483,0.0146635,0.0146783,0.0146928,0.014707,0.0147209,0.0147345,0.0147478,0.0147608,0.0147736,0.0147861,0.0147983,0.0148103,0.014822,0.0148335,0.0148447,0.0148557,0.0148665,0.014877,0.0148873,0.0148974,0.0149073,0.014917,0.0149265,0.0149358,0.0149448,0.0149537,0.0149625,0.014971,0.0149794,0.0149876,0.0149956,0.0150035,0.0150112,0.0150188,0.0150262,0.0150334,0.0150406,0.0150476,0.0150544,0.0150612,0.0150678,0.0150742,0.0150806,0.0150868,0.0150929,0.015099,0.0151049,0.0151106,0.0151163,0.0151219,0.0151274,0.0151328,0.0151381,0.0151433,0.0151485,0.0151535,0.0151584,0.0151633,0.0151681,0.0151728,0.0151774,0.015182,0.0151865,0.0151909,0.0151952,0.0151995,0.0152037,0.0152079,0.015212,0.015216,0.0152199,0.0152238,0.0152277,0.0152315,0.0152352,0.0152389,0.0152425,0.0152461,0.0152496,0.0152531,0.0152565,0.0152599,0.0152632,0.0152665,0.0152697,0.0152729,0.0152761,0.0152792,0.0152823,0.0152853,0.0152883,0.0152913,0.0152942,0.0152971,0.0152999,0.0153027,0.0153055,0.0153083,0.015311,0.0153136,0.0153163,0.0153189,0.0153215,0.015324,0.0153266,0.015329,0.0153315,0.0153339,0.0153363,0.0153387,0.0153411,0.0153434,0.0153457,0.015348,0.0153502,0.0153524,0.0153546,0.0153568,0.015359,0.0153611,0.0153632,0.0153653,0.0153673,0.0153694,0.0153714,0.0153734,0.0153753,0.0153773,0.0153792,0.0153811,0.015383,0.0153849,0.0153868,0.0153886,0.0153904,0.0153922,0.015394,0.0153957,0.0153975,0.0153992,0.0154009,0.0154026,0.0154043,0.015406,0.0154076,0.0154092,0.0154108,0.0154124,0.015414,0.0154156,0.0154171,0.0154187,0.0154202,0.0154217,0.0154232,0.0154246,0.0154261,0.0154276,0.015429,0.0154304,0.0154318,0.0154332,0.0154346,0.015436,0.0154373,0.0154387,0.01544,0.0154413,0.0154426,0.0154439,0.0154452,0.0154465,0.0154477,0.015449,0.0154502,0.0154514,0.0154526,0.0154538,0.015455,0.0154562,0.0154574,0.0154585,0.0154597,0.0154608,0.0154619,0.0154631,0.0154642,0.0154653,0.0154664,0.0154674,0.0154685,0.0154696,0.0154706,0.0154716,0.0154727,0.0154737,0.0154747,0.0154757,0.0154767,0.0154777,0.0154787,0.0154796,0.0154806,0.0154815,0.0154825,0.0154834,0.0154843,0.0154852,0.0154861,0.015487,0.0154879,0.0154888,0.0154897,0.0154906,0.0154914,0.0154923,0.0154931,0.015494,0.0154948,0.0154956,0.0154964,0.0154972,0.015498,0.0154988,0.0154996,0.0155004,0.0155012,0.0155019,0.0155027,0.0155034,0.0155042,0.0155049,0.0155057,0.0155064,0.0155071,0.0155078,0.0155085,0.0155092,0.0155099,0.0155106,0.0155113,0.0155119,0.0155126,0.0155133,0.0155139,0.0155146,0.0155152,0.0155159,0.0155165,0.0155171,0.0155178,0.0155184,0.015519,0.0155196,0.0155202,0.0155208,0.0155214,0.015522,0.0155225,0.0155231,0.0155237,0.0155242,0.0155248,0.0155254,0.0155259,0.0155265,0.015527,0.0155275,0.0155281,0.0155286,0.0155291,0.0155296,0.0155301,0.0155306,0.0155311};
char incomingByte;
volatile uint16_t rejactory_count = 0;
motor stepper_motor;


void setup() {
    Serial.begin(9600);

    stepper_motor.motor_init();

    //Here User has to give a keyboard signal to start the game
    Serial.println("wait for pressing keyboard to start");
    while(Serial.available()==0);
    Serial.println("started");

    /*
     * Set target motor RPM.
     * These motors can do up to about 200rpm.
     * Too high will result in a high pitched whine and the motor does not move.
     */

    //Initilize the soft interrupt with 100Hz

    Serial.println(stepper_motor.angle_to_position(0.16725));
    rejactory_count = 20;
    stepper_motor.initialize_position(stepper_motor.angle_to_position(traj_ref[rejactory_count]));
    rejactory_count++;

    Timer3.initialize(10000);
    Timer3.attachInterrupt(control); // blinkLED to run every 0.15 seconds
}

uint16_t t = 0;
uint8_t position = 0;
uint8_t temp_position =0;
unsigned long int temp = 0;
unsigned long int duration = 0;

void loop() {

  // delay(100);
  // Serial.println(duration);
  if (Serial.available()>0){
    incomingByte = Serial.read();
    if(incomingByte == 'a'){
      stepper_motor.move(1);
    }else if (incomingByte == 's'){
      stepper_motor.move(-1);
    }
    Serial.println(stepper_motor.get_current_position());
  }

}

void control(){
  if(rejactory_count<500) {
      int16_t next_steps = ((int16_t)stepper_motor.angle_to_position(traj_ref[rejactory_count])) - (399-stepper_motor.get_current_position());

      stepper_motor.move(next_steps);
      // Serial.println((int)stepper_motor.angle_to_position(traj_ref[rejactory_count]));
      // Serial.println(399-stepper_motor.get_current_position());
      // Serial.println(next_steps);
      // Serial.println();
      rejactory_count++;
  }
  // else if (rejactory_count==5){
  //     rejactory_count=300;
  // }
  // duration = millis() - temp;
  // temp = millis() ;
  // stepper_motor.move(1);

}
